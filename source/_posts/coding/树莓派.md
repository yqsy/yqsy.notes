---
title: 树莓派
date: 2018-1-23 21:44:24
categories: [coding]
---

<!-- TOC -->

- [1. 资料](#1-资料)
- [2. 我的实践](#2-我的实践)
- [3. 基础安装](#3-基础安装)
- [4. 内网穿透](#4-内网穿透)
- [5. docker](#5-docker)
- [6. owncloud](#6-owncloud)
- [7. opengrok](#7-opengrok)
- [8. 天气/温度/PM指数](#8-天气温度pm指数)

<!-- /TOC -->


<a id="markdown-1-资料" name="1-资料"></a>
# 1. 资料
* https://www.zhihu.com/question/20859055/answer/54734499 (可以用来干嘛)
* https://www.raspberrypi.org/products/raspberry-pi-3-model-b/ (官网)
* https://www.zhihu.com/question/31632573/answer/53608346 (装哪些发行版)
* https://www.raspberrypi.org/documentation/installation/installing-images/README.md (Raspbian 根目录放ssh开启sshd服务 默认密码raspberry)
* https://www.zhihu.com/question/49629610/answer/126092240 (内网穿透)
* https://ngrok.com/docs (ngrok的说明)
* https://dashboard.ngrok.com/get-started (开始)
* https://www.ngrok.cc/ (免费中转站)
* https://github.com/fatedier/frp (frp)


配置
```
Quad Core 1.2GHz Broadcom BCM2837 64bit CPU
1GB RAM
BCM43438 wireless LAN and Bluetooth Low Energy (BLE) on board
40-pin extended GPIO
4 USB 2 ports
4 Pole stereo output and composite video port
Full size HDMI
CSI camera port for connecting a Raspberry Pi camera
DSI display port for connecting a Raspberry Pi touchscreen display
Micro SD port for loading your operating system and storing data
Upgraded switched Micro USB power source up to 2.5A
```

<a id="markdown-2-我的实践" name="2-我的实践"></a>
# 2. 我的实践

* ngrok 或 frp内网穿透 (tcp可直接用ssh穿)
* 公网注册域名 树莓派自动获取公网ip通知域名厂商更换动态域名
* https://owncloud.org/download/ (私有云)
* opengrok (hub没最新的,自己做docker image)
* https反向代理http安全访问
* 天气/温度/PM指数/整点时间 播报
* bt下载机 transmission aria2 (可磁力)
* 爬虫
* 小网站
* dnsmasq
* 监控

<a id="markdown-3-基础安装" name="3-基础安装"></a>
# 3. 基础安装

* wheezy (oldoldstable)
* jessie (oldstable)
* stretch (stable) 
* buster (testing)
* sid (unstable)

`cat /etc/*-release`查看操作系统哪个源

```bash
# 源修改
sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak
sudo rm -f /etc/apt/sources.list
sudo touch /etc/apt/sources.list

echo "deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ stretch main non-free contrib" | sudo tee -a /etc/apt/sources.list
echo "deb-src http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ stretch main non-free contrib" | sudo tee -a /etc/apt/sources.list

sudo apt-get update -y

apt-get install git -y
apt-get install vim -y

# zsh
apt-get install zsh -y
chsh -s /bin/zsh

curl -L https://raw.githubusercontent.com/yqsy/vim/master/etc/zshrc.zsh > ~/.zshrc

# 网络流量分析
sudo apt-get install iptraf-ng -y

# 实时网速查看
sudo apt-get install bwm-ng -y

# glances
sudo apt-get install glances -y
```

<a id="markdown-4-内网穿透" name="4-内网穿透"></a>
# 4. 内网穿透
frp server
```bash
# server
wget https://github.com/fatedier/frp/releases/download/v0.15.1/frp_0.15.1_linux_amd64.tar.gz
tar -xvzf frp_0.15.1_linux_amd64.tar.gz
cd frp_0.15.1_linux_amd64

sed -i "s/bind_port = 7000/bind_port = 5001/g" ./frps.ini
./frps -c ./frps.ini

# run in back (问题?)
# nohup ./frps -c ./frps.ini | rotatelogs /var/log/frp.log-%Y%m%d 86400 &

nohup ./frps -c ./frps.ini > /var/log/frp.log 2>&1 &
```

frp client
```bash
wget https://github.com/fatedier/frp/releases/download/v0.15.1/frp_0.15.1_linux_arm.tar.gz
tar -xvzf frp_0.15.1_linux_arm.tar.gz
cd frp_0.15.1_linux_arm
sed -i "s/server_port = 7000/server_port = 5001/g" ./frpc.ini
sed -i "s/server_addr = 127.0.0.1/server_addr = 112.74.61.253/g" ./frpc.ini

# 默认映射6000->127.0.0.1:22
./frpc -c ./frpc.ini

# run in back
nohup ./frpc -c ./frpc.ini > /var/log/frp.log 2>&1 &
```

ngrok
```bash
cd ~!
wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-arm.zip
unzip ngrok-stable-linux-arm.zip

# 这个不行,启动会出错
wget http://121.42.171.79:9100/frp/linux_arm.zip
unzip linux_arm.zip

./ngrok authtoken  xxxx 这个是authtoken

./ngrok http 80
./ngrok tcp 22

# 暴露了一个端口
http://127.0.0.1:4040

# 在本机上使用ssh tunnel,即可访问
ssh -NL  9001:localhost:4040 root@pi1
```

ssh
```bash
chmod 700 ~/.ssh/id_rsa

eval `ssh-agent -s`
ssh-add ~/.ssh/id_rsa

# 开放22端口给server的127.0.0.1:6001
nohup  ssh -NR 6001:localhost:22 root@al1 &

# 在server上:
nohup ssh -g -NL 6000:localhost:6001 root@localhost &
```

<a id="markdown-5-docker" name="5-docker"></a>
# 5. docker 

* http://blog.csdn.net/candcplusplus/article/details/53958929  (arm装docker踩坑)
* https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/ (清华 安装docker)
* https://docs.docker.com/compose/install/#install-compose (docker-compose)

```bash
# docker
# 装不了?
# curl -sSL https://get.docker.com | sh

sudo apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common -y

curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
echo "deb [arch=armhf] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian \
     $(lsb_release -cs) stable" | \
    sudo tee /etc/apt/sources.list.d/docker.list
sudo apt-get update
sudo apt-get install docker-ce -y

# 改变源
mkdir -p /etc/docker
echo \
"{
  \"registry-mirrors\": [\"https://registry.docker-cn.com\"]
}" > /etc/docker/daemon.json

systemctl start docker
systemctl enable docker

systemctl status docker

apt-get install docker-compose -y
```
<a id="markdown-6-owncloud" name="6-owncloud"></a>
# 6. owncloud

* https://hub.docker.com/r/arm32v7/owncloud/
* https://github.com/docker-library/owncloud/blob/146a37ed55bb70778feef7f4ce5a8b56b8a4b3ce/10.0/apache/Dockerfile (dockerfile)
* https://hub.docker.com/r/l3iggs/owncloud/ (带https的)
* https://owncloud.org/ (官网)

arm
```bash
docker run -d -p 80:80 arm32v7/owncloud:latest
```

<a id="markdown-7-opengrok" name="7-opengrok"></a>
# 7. opengrok

* https://hub.docker.com/r/scue/docker-opengrok/  (dockerfile下载的jar包跳转到github了,但是下载github速度慢)
* https://github.com/scue/docker-opengrok/blob/master/Dockerfile (上面的dockerfile)

还是要自己做一个docker image的

构建opengrok的image的问题
* 源拉取时使用国内镜像资源 (这个设置了http_proxy会不会也使用到http_proxy?)
* apt-get update && apt-get install 使用http proxy
* wget 使用 http proxy
* image上传到哪里?

<a id="markdown-8-天气温度pm指数" name="8-天气温度pm指数"></a>
# 8. 天气/温度/PM指数
