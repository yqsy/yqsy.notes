---
title: 新服务器搭建
date: 2017-10-22 23:56:44
categories: [linux, 搭建环境]
---

<!-- TOC -->

- [1. 流程](#1-流程)
- [临时](#临时)

<!-- /TOC -->

<a id="markdown-1-流程" name="1-流程"></a>
# 1. 流程

* 创建开发账号,sudo权限,设置证书,禁止密码登录,禁止root登陆
* 操作系统源设置(暂时不需要,会自动选择)
* 时区设置,定时从服务器更新时间
* 关闭selinux,iptables
* 文件描述符数量调整
* 内核参数优化
* zsh vim 各种帮助开发/诊断 工具 (可选)
* 监控/报警


<a id="markdown-临时" name="临时"></a>
# 临时

```bash
# 最大打开文件数
sudo bash -c 'cat >> /etc/security/limits.conf' << EOF
*      soft  nofile    65535
*      hard  nofile    65535
EOF

# tcp
sudo bash -c 'cat >> /etc/sysctl.conf' << EOF
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_syn_retries = 1
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.ip_local_port_range = 1024 65535
EOF

sudo sysctl -p

# 关闭iptables
sudo systemctl stop firewalld && sudo systemctl disable firewalld

# 关闭selinux
sudo setenforce 0
sudo sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config

# sshd
sudo sed -i 's@#UseDNS yes@UseDNS no@' /etc/ssh/sshd_config
sudo system restart sshd

# 时区
sudo timedatectl set-timezone "Asia/Shanghai"

# ntp
sudo yum install ntp -y

sudo bash -c 'cat >> /etc/crontab' << EOF
01 01 * * * sudo /usr/sbin/ntpdate ntp.api.bz
EOF

sudo /usr/sbin/ntpdate ntp.api.bz

sudo systemctl restart crond

# 增加账户
sudo groupadd -g 2018 yq
sudo useradd -u 2018 -g 2018 -d /home/yq yq
sudo mkdir -p /home/yq
sudo chown yq:yq /home/yq
sudo chsh -s /bin/bash yq

sudo bash -c 'cat >> /etc/sudoers' << EOF
%yq  ALL=(ALL)       NOPASSWD: ALL
EOF

# 证书
sudo su - yq

curl -O https://raw.githubusercontent.com/yqsy/linux_script/master/id_rsa.pub
mkdir ~/.ssh
chmod 700 ~/.ssh
touch ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
cat id_rsa.pub >>  ~/.ssh/authorized_keys
rm id_rsa.pub -f

sudo sed -i "s/.*PasswordAuthentication.*/PasswordAuthentication no/g" /etc/ssh/sshd_config
sudo systemctl restart sshd

sudo reboot
```
