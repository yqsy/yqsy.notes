---
title: 进程管理
date: 2017-10-23 14:26:38
categories: [linux, 系统管理]
---

<!-- TOC -->

- [1. 进程的分类](#1-%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%86%E7%B1%BB)
- [2. 进程的属性](#2-%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%B1%9E%E6%80%A7)
- [3. 常用的指令](#3-%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8C%87%E4%BB%A4)
- [4. 任务调度进程crond的使用](#4-%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E8%BF%9B%E7%A8%8Bcrond%E7%9A%84%E4%BD%BF%E7%94%A8)
    - [4.1. crontab文件的含义](#41-crontab%E6%96%87%E4%BB%B6%E7%9A%84%E5%90%AB%E4%B9%89)
    - [4.2. 注意点](#42-%E6%B3%A8%E6%84%8F%E7%82%B9)
- [5. 终止进程](#5-%E7%BB%88%E6%AD%A2%E8%BF%9B%E7%A8%8B)
    - [5.1. 强制关闭了父进程](#51-%E5%BC%BA%E5%88%B6%E5%85%B3%E9%97%AD%E4%BA%86%E7%88%B6%E8%BF%9B%E7%A8%8B)
- [6. job control](#6-job-control)

<!-- /TOC -->

# 1. 进程的分类

* 系统进程
可以执行内存资源分配和进程切换等管理工作,而且该进程的运行不受用户的干预,即便是root用户也不能干预系统进程的运行

* 用户进程
 * 交互进程: 由一个Shell终端启动的进程,在执行过程中,需要与用户进程交互操作,可以运行于前台,也可以运行在后台
 * 批处理进程: 该进程是一个进程集合,负责按顺序启动其他的进程
 * 守护进程: 一直运行的一种进程,经常在Linux系统启动时启动,在系统关闭时终止,它们独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件,例如httpd,cond


# 2. 进程的属性
进程存在很多种状态
* 可运行状态: 处于这种状态的进程,要么正在运行,要么正准备运行
* 可中断的等待状态: 这类进程处于阻塞状态,一旦达到某种条件,就会变为运行状态,同时该状态的进程也会由于接收到信号而被提前唤醒进入到运行状态
* 不中断的等待状态: 与`可中断的等待状态`含义基本类似,唯一不同的是处于这个状态的进程对信号不做响应
* 僵死状态: 每个进程在结束后都会处于僵死状态,等待父进程调用进而释放资源
* 暂停状态: 表明此时的进程暂时停止,来接收某种特殊处理

进程的PID是有限制的,最大ID为32768,用UID和GID分别表示启动这个进程的用户和用户组,PPID表示父进程


# 3. 常用的指令

lsof(list opened files)
```bash
# 知道文件被哪个程序在使用
lsof /var/log/messages

# 显示进程现在打开的文件
lsof -c abc

# 显示指定的进程组打开的文件情况
lsof -g gid

# 显示进程打开的所有文件及相关进程
lsof -p PID
```

```bash
# 观察系统所有的程序数据
ps aux
ps -lA

# 连同部分程序树状态
ps axjf

# 仅观察bash相关的
ps -l
```

# 4. 任务调度进程crond的使用
Linux下的任务调度分为两类,及系统任务调度和用户任务调度  
系统任务调度: 系统周期性所要执行的工作,比如写缓存数据到硬盘,日志清理等`/etc/contab`  

-u user: 用来设定某个用户的crontab服务,例如 '-u ixdba'表示设定ixdba用户的crontab服务  
file: 表示将file作为crontab的任务列表文件并载入crontab  
-e: 编辑某个用户的crontab文件内容,如果不指定用户,则表示编辑当前用户的crontab文件  
-l: 显示某个用户的crontab文件内容,如果不指定用户,则表示显示当前用户的crontab文件内容  
-r: 从`/var/spool/cron`目录中删除某个用户的crontab文件,如果不指定用户,则默认删除当前用户的crontab文件  
-i: 在删除用户的crontab文件时给确认提示  

## 4.1. crontab文件的含义

minute hour day month week command

* minute: 表示分钟, 0~59
* hour: 表示小时, 0~23
* day: 表示日期, 1~31
* month: 表示月份,1~12
* week: 表示星期几, 0~7
* command: 要执行的命令,可以是系统命令,也可以是自己编写的脚本
* 星号(*) : 代表所有可能的值,例如month字段如果是星号,则表示在满足其他字段制约条件后每月都执行该命令操作
* 逗号(,): 可以用整数之间的中杠表示一个整数范围
* 正斜线(/): 可以用正斜线指定时间的间隔频率,例如'0-23/2'表示每2小时执行一次,*/10,如果用在minute字段,就表示每10分钟执行一次

```
# 表示每隔3个小时重启Apache服务一次
0 */3 * * * /usr/local/apache2/apachectl restart

# 表示每周六的3点30分执行/webdata/bin/backup.sh脚本的操作
30 3 * * 6 /webdata/bin/backup.sh

# 表示每个月的1号和20号检查/dev/sdb8磁盘设备
0 0 1,20 * * fsck /dev/sdb8

# 表示每个月的5号,10号,15号,20号,25号,30号的5点10分执行清理Apache日志操作
10 5 */5 * * echo "">/usr/local/apache2/log/access_log
```

## 4.2. 注意点
* 注意设置crontab启动脚本时的环境变量
* 注意清流系统用户的邮件日志,因为每条任务调度执行完毕,系统都会将任务输出信息通过电子邮件的形式发送给当前系统用户
```
# 将标准输出重定向到/dev/null,将标准错误重定向到标准输出
0 */3 * * * /usr/local/apache2/apachectl restart > /dev/null 2>&1
```

# 5. 终止进程
kill
* -2,表示结束进程，但是并不是强制性的，常用的“Ctrl＋C”组合键发出的就是一个kill-2的信号。`SIGINT`
* -9 ,表示强制结束进程 `SIGKILL`
* -15,：表示正常结束进程，是kill的缺省选项，也就是kill不加任何信号类型时，默认类型就是15。`SIGREAM`

killall 后面跟的是进程的名字,而不是进程的PID

## 5.1. 强制关闭了父进程
子进程并不会因为父进程的关闭而自动关闭,子进程的`PPID`会由原来的xxx变成1,而正常关闭进程的操作中,父进程在自己终止时,会同时调用资源关闭子进程,释放内存


# 6. job control
```bash

# 末尾加上&表示放置于背景中执行
cp file1 file2 &

# 有个问题,背景当中执行的指令,如果有stdout及stderr时,数据依旧时输出到屏幕上面的
 tar -cvzf id_rsa.pub.tgz id_rsa.pub &

# 可以这样做,重定向
 tar -cvzf id_rsa.pub.tgz id_rsa.pub > /tmp/log.txt 


# 参照https://stackoverflow.com/questions/4797050/how-to-run-process-as-background-and-never-die

nohup tar -cvzf id_rsa.pub.tgz id_rsa.pub > /tmp/log.txt 2>&1 &

# nohup 让你在离线或登出系统后,还能够让工作继续进行
# > /tmp/log.txt stdout 重定向
# 2>&1 stderr重定向到stdout
# & 背景任务

# 将"目前"的工作丢到背景中"暂停"
[ctrl] + z

# 查看目前背景工作状态
jobs

# 将背景工作拿到前景来处理
fg %jobnumber

# 让工作在背景下的状态变成运行中
bg %jobnumber

# 列出kill的信号
kill -l 

# kill -1: 重新读取一次参数的配置文件?
# kill -2: 代表由键盘输入 [ctrl]-c 同样的动作
# kill -9: 立即强制删除一个工作
# kill -15: 以正常的方式终止一个工作, 与 -9是不一样的 (默认)

# kill背景当中的工作
kill -15 %1
```
