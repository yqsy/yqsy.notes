---
title: 安全管理
date: 2017-10-23 20:56:18
categories: [linux, 系统管理]
---

<!-- TOC -->

- [1. 学习资源](#1-学习资源)
- [2. 给服务器加上公钥](#2-给服务器加上公钥)
- [3. 客户端使用私钥登录](#3-客户端使用私钥登录)
    - [3.1. linux使用私钥](#31-linux使用私钥)
- [4. agent](#4-agent)
    - [4.1. windows环境](#41-windows环境)
    - [4.2. linux环境](#42-linux环境)
- [5. 关闭root登录](#5-关闭root登录)
- [6. 禁止系统响应任何从外部/内部来的ping请求](#6-禁止系统响应任何从外部内部来的ping请求)
- [7. 限制bash_history记录](#7-限制bash_history记录)
- [8. 删除不必要的用户和组](#8-删除不必要的用户和组)
- [关闭selinux](#关闭selinux)
- [设定tcp_wrappers防火墙](#设定tcp_wrappers防火墙)
- [iptables](#iptables)
    - [各个链的详细功能](#各个链的详细功能)
        - [filter表](#filter表)
        - [nat表](#nat表)
        - [mangle表](#mangle表)

<!-- /TOC -->


# 1. 学习资源
* https://kb.iu.edu/d/aews (ssh扫盲)
* http://blog.csdn.net/xcbeyond/article/details/38855069 (ssh经验)
* https://www.zhihu.com/question/25912483 (ssh原理)
* https://help.github.com/articles/connecting-to-github-with-ssh/ (github ssh资料)


# 2. 给服务器加上公钥
```bash
# 创建证书文件夹
mkdir /root/.ssh
chmod 700 /root/.ssh

# rz或scp或联系系统管理员上传公钥至服务器
touch ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys

# 增加公钥
cat id_rsa_2048.pub >>  ~/.ssh/authorized_keys

# 禁止密码登陆
sed -i "s/.*PasswordAuthentication.*/PasswordAuthentication no/g" /etc/ssh/sshd_config

# 重启服务
systemctl restart sshd
```


# 3. 客户端使用私钥登录
```bash
# 指定私钥登录
ssh root@45.32.17.217 -i ./id_rsa_2048
```

## 3.1. linux使用私钥
```bash
# 先拷贝上去
pscp ./id_rsa_2048 root@35.194.205.194:/root/.ssh
mv id_rsa_2048 id_rsa

# linux must set ro r--------
chmod 400 ~/.ssh/id_rsa
```

# 4. agent

* https://stackoverflow.com/questions/21095054/ssh-key-still-asking-for-password-and-passphrase
* http://www.unixwiz.net/techtips/ssh-agent-forwarding.html

If you're correctly using SSH when cloning / setting remotes. `Then make sure you have a ssh-agent to remember your password. `That way, you'll only enter your passphrase once by terminal session.

程序|agent
-|-
xshell|Xagent
putty|pageant
git|PLINK.EXE/pageant
tortoisegit|PLINK.EXE/pageant
ssh|ssh-agent


## 4.1. windows环境

```bash
# 通过私钥生成putty ppk
puttygen

# git使用plink,tortoise也设置成这个
设置环境变量GIT_SSH为C:\Program Files (x86)\PuTTY\plink.exe

# 启动PAGEANT
pageant
```

## 4.2. linux环境
```bash
eval `ssh-agent -s`

# linux注意权限
chmod 700 ./id_rsa_2048

ssh-add ./id_rsa_2048

# linux设置启动bash就启动ssh-agent
echo 'eval `ssh-agent -s`' >> ~/.bashrc
echo 'ssh-add /root/id_rsa_2048' >> ~/.bashrc
```

# 5. 关闭root登录
```bash
# TODO 使用sed
vim /etc/ssh/sshd_config
PermitRootLogin  no
```

# 6. 禁止系统响应任何从外部/内部来的ping请求
```bash
echo "1" >/proc/sys/net/ipv4/icmp_echo_ignore_all
```

# 7. 限制bash_history记录
```bash
vim /etc/profile
HISTSIZE=30
```

# 8. 删除不必要的用户和组
```bash
userdel adm
userdel lp
userdel sync
userdel shutdown
userdel halt
userdel news
userdel uucp
userdel operator
userdel games
userdel gopher

groupdel adm
groupdel lp
groupdel news
groupdel uucp
groupdel games
groupdel dip
groupdel pppusers
groupdel popusers
groupdel slipusers
```

# 关闭selinux
```bash
# 查看selinux是否启动
getenforce

vim /etc/sysconfig/selinux
SELINUX=disabled

# 重启
reboot
```


# 设定tcp_wrappers防火墙
> tcp_wrappers是一个用来分析TCP/IP封包的软件,类似的IP封包软件还有iptables,Linux本身有两层安全防火墙，通过IP过滤机制的iptables实现第一层防护,如果通过了第一层防护，那么下一层防护就是tcp_wrappers了,通过tcp_wrappers可以实现对系统中提供的某些服务的开放与关闭、允许和禁止，从而更有效地保证系统安全运行。

* service: 代表服务名,例如: sshd, vsftpd和sendmail等
* host(s): 主机名或者IP地址,可以有多个,例如192.168.60.0,www.ixdba.net
* action: 动作,符合条件后采取的动作
* ALL:所有服务或者所有IP
* ALL EXCEPT: 所有的服务或者所有IP除去指定的

```
/etc/hosts.allow
/etc/hosts.deny
```



# iptables

## 各个链的详细功能

### filter表
链名称|链作用
-|-
INPUT链|主要是对外部数据包进入Linux系统进行信息过滤
OUTPUT链|主要时对内部Linux系统索要发送的数据包进行信息过滤
FORWARD链|将外面过来的数据包传递到内部计算机中


### nat表
链名称|链作用
-|-
PREROUTING链|是在数据包刚刚达到防火墙时,根据需要改变它的目的地址,例如DNAT操作,就是通过一个合法的公网IP地址,通过对防火墙的定向,重定向到防火墙内的其他计算机
INPUT链|
OUTPUT链|改变了本地产生包的目的地址
POSTROUTING链|在包就要离开防火墙之前改变其源地址,例如SNAT操作,屏蔽了本地局域网主机的信息,本地主机通过防火墙链接到Inertnet,这样在Internet上看到的本地主机的来源地址都是同一个IP,屏蔽了来源主机信息


### mangle表
不常用,不记录了

