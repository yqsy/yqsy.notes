---
title: 代理
date: 2017-12-26 16:18:06
categories: [工程问题]
---


<!-- TOC -->

- [1. 资源](#1-资源)
- [2. 测速度](#2-测速度)
- [3. 搭建](#3-搭建)
    - [3.1. shadowsocks](#31-shadowsocks)
    - [3.2. shadowsocksr](#32-shadowsocksr)

<!-- /TOC -->


<a id="markdown-1-资源" name="1-资源"></a>
# 1. 资源

* https://www.proxifier.com/ (让进程走代理)
* https://www.sockscap64.com/ (让进程走代理)
* http://www.maxiaodong.com/blog/2016/05/vpn%E7%B1%BB%E5%9E%8B%E7%A7%91%E6%99%AE-%E5%90%84%E7%A7%8D%E5%8D%8F%E8%AE%AE%EF%BC%88pptp%E3%80%81l2tp%E3%80%81-openvpn%E3%80%81-sstp%E3%80%81-ikev2%EF%BC%89.html (代理科普)
* http://stackissue.com/breakwa11/shadowsocks-rss/shadowsocks-38.html (ss加密)

客户端
* https://github.com/dfdragon/kcptun_gclient (kcp客户端)
* https://github.com/shadowsocks/shadowsocks-windows/releases (ss windows客户端)
* https://shadowsocks.org/en/download/clients.html (全部客户端)
* https://github.com/shadowsocks/shadowsocks-android/releases (android 客户端)
* https://github.com/shadowsocks/kcptun-android/releases (kcp android)

开源方案
* https://github.com/shadowsocks/shadowsocks (ss python)
* https://github.com/xtaci/kcptun (双边加速kcptun)
* https://github.com/d1sm/finalspeed (finalspeed)
* https://github.com/henices/Tcp-DNS-proxy (dns proxy)
* https://github.com/jpillora/go-tcp-proxy (go tcp proxy)
* https://github.com/jpillora/chisel (go fast tunnel over http)
* https://github.com/xjdrew/kone (透明代理)
* https://github.com/vzex/dog-tunnel (dog tunnel)
* https://github.com/darkk/redsocks (red socks)
* https://github.com/google/bbr (bbr)
* https://github.com/greatfire/wiki (自由浏览器)


其他
* https://tang.biz/google-every-where.html (搭建google反向代理)
* https://github.com/feliscatus/switchyomega (chrome 非常好用的插件)
* https://github.com/FelisCatus/SwitchyOmega/wiki/GFWList (配合gfwlist)

<a id="markdown-2-测速度" name="2-测速度"></a>
# 2. 测速度

```bash
# 本机在远程打通一个端口
ssh -NR 6000:localhost:6000 root@vul1

# 本机
nc -l 6000

# 远程
dd if=/dev/zero bs=1MB count=1000 | nc localhost 6000
```


用kcp测试
```bash
# server
mkdir -p ~/env/kcp
cd ~/env/kcp
wget https://github.com/xtaci/kcptun/releases/download/v20171201/kcptun-linux-amd64-20171201.tar.gz
tar -xvzf kcptun-linux-amd64-20171201.tar.gz

./server_linux_amd64 -t "localhost:22" -l ":4000" -mode fast2

# client
mkdir -p ~/env/kcp
cd ~/env/kcp

# 代理下 (为啥本机的代码返回success wget错误?)
ssh -ND 1080 root@vul1 

export http_proxy="http://localhost:1080"
export https_proxy="http://localhost:1080"

wget https://github.com/xtaci/kcptun/releases/download/v20171201/kcptun-linux-arm-20171201.tar.gz

tar -xvzf kcptun-linux-arm-20171201.tar.gz

./client_linux_arm7 -r "vul1:4000" -l ":22222" -mode fast2

# 在远程上注册打通本机端口
ssh -NR 6000:localhost:6000 root@localhost -p 22222

# 本机
nc -l 6000

# 远程
dd if=/dev/zero bs=1MB count=1000 | nc localhost 6000
```

<a id="markdown-3-搭建" name="3-搭建"></a>
# 3. 搭建

<a id="markdown-31-shadowsocks" name="31-shadowsocks"></a>
## 3.1. shadowsocks

kcp走向  
socks5  localhost:1080 ---tcp--- localhost:10001 ---udp--- dgc:4000 ---tcp--- localhost:443

```bash
export SS_PASSWD=xxx
```

client
```bash
pip install shadowsocks -i https://pypi.tuna.tsinghua.edu.cn/simple
sslocal.exe -s 127.0.0.1 -p 10001 -k $SS_PASSWD -m aes-256-cfb

client_windows_amd64.exe -r "dgc1:4000" -l ":10001" -mode fast2
```

server
```bash
# ss
yum install python34 -y
yum install python34-pip -y
pip3 install shadowsocks -i https://pypi.tuna.tsinghua.edu.cn/simple


sudo mkdir /var/log/shadowsocks
sudo chown $(id -u):$(id -g) /var/log/shadowsocks
nohup ssserver -p 443 -k $SS_PASSWD -m aes-256-cfb > /var/log/shadowsocks/shadowsocks.log 2>&1 &

# kcp
cd ~/env/kcp
sudo mkdir /var/log/kcptun
sudo chown $(id -u):$(id -g) /var/log/kcptun
nohup ./server_linux_amd64 -t "localhost:443" -l ":4000" -mode fast2 > /var/log/kcptun/kcptun.log 2>&1 &
```

<a id="markdown-32-shadowsocksr" name="32-shadowsocksr"></a>
## 3.2. shadowsocksr

socks5 localhost:1080 ---tcp--- localhost:10002 ---udp--- dgc:4001 ---tcp--- localhost:444

server
```bash
mkdir -p ~/reference
cd ~/reference
git clone https://github.com/shadowsocksr-backup/shadowsocksr
cd shadowsocksr
git checkout manyuser


mkdir -p ~/env/shadowsocksr
cd ~/env/shadowsocksr

cat > ./config.json << EOF
{
    "server":"0.0.0.0",
    "server_ipv6": "[::]",
    "port_password":{
        "444":"$SS_PASSWD"
    },
    "timeout":300,
    "method":"aes-256-cfb",
    "protocol": "auth_aes128_md5",
    "protocol_param": "",
    "obfs": "tls1.2_ticket_auth_compatible",
    "obfs_param": "",
    "redirect": "",
    "dns_ipv6": false,
    "fast_open": false,
    "workers": 1
}
EOF


sudo mkdir /var/log/shadowsocksr
sudo chown $(id -u):$(id -g) /var/log/shadowsocksr
nohup python3 ~/reference/shadowsocksr/shadowsocks/server.py -c `pwd`/config.json > /var/log/shadowsocksr/shadowsocksr.log 2>&1 &

cd ~/env/kcp
nohup ./server_linux_amd64 -t "localhost:444" -l ":4001" -mode fast2 > /var/log/kcptun/kcptun2.log 2>&1 &
```
