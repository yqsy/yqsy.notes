---
title: 难度调整
date: 2018-02-01 13:29:12
categories: [business, bitcoin]
---


<!-- TOC -->

- [1. 难度公式](#1-难度公式)
    - [1.1. 主网](#11-主网)
    - [1.2. 测试网络](#12-测试网络)
    - [1.3. 本地测试网](#13-本地测试网)
- [2. nBits和target](#2-nbits和target)

<!-- /TOC -->


<a id="markdown-1-难度公式" name="1-难度公式"></a>
# 1. 难度公式

* https://en.bitcoin.it/wiki/Difficulty#What_is_.22difficulty.22.3F
* https://blockexplorer.com/api/status?q=getDifficulty (获取难度)


<a id="markdown-11-主网" name="11-主网"></a>
## 1.1. 主网
![](./pic/difficulity.png)

```bash
难度公式:
新的难度 = 旧的难度 * (过去2016区块的时间 / 两周时间)

限制1: 
过去2016区块的时间会调整为[两周时间/4,两周时间*4]之内,也就是难度会限制在增长/减少4倍之内

限制2:
难度不会低于设置的最小难度值
```


<a id="markdown-12-测试网络" name="12-测试网络"></a>
## 1.2. 测试网络

![](./pic/diffculity2.png)

```
情况1:
当前生成区块与上一区块的时间间隔超过20分钟,则难度取为设置的最小难度值

情况2:
当生成区块与上一区块的时间间隔不超过20分钟时,恢复难度
```

<a id="markdown-13-本地测试网" name="13-本地测试网"></a>
## 1.3. 本地测试网
![](./pic/diffculity3.png)

```
情况1与情况2和上述相同
```


<a id="markdown-2-nbits和target" name="2-nbits和target"></a>
# 2. nBits和target

* https://bigishdata.com/2017/11/13/how-to-build-a-blockchain-part-4-1-bitcoin-proof-of-work-difficulty-explained/

```python
# 难度表示, 例如难度nBits == 0x1903a30c
# 前两位十六进制数字为幂(exponent)
# 接下来六位为系数(coefficient)

target = 幂 * 2^(8 * (系数 - 3))

target = 0x03a30c * 2 ** (0x08 * (0x19 - 3))
target_str = '%X' % target
target_str = "0x" +  "0" * (64 - len(target_str)) + target_str
```

