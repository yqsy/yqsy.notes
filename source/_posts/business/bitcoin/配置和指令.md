---
title: 配置和指令
date: 2018-02-01 13:29:12
categories: [business, bitcoin]
---

<!-- TOC -->

- [1. 说明](#1-说明)

<!-- /TOC -->



<a id="markdown-1-说明" name="1-说明"></a>
# 1. 说明

配置
```bash
# 禁用钱包
--disable-wallet

# 钱包中允许使用不兼容版本的Berkeley DB库
--with-incompatible-bdb

# 不构建图形用户界面
--with-gui=no

# 用户名和密码
~/.bitcoin / bitcoin.conf

rpcuser=bitcoinrpc
rpcpassword=CHANGE_THIS

# 要放入所有区块链数据的目录和文件系统
datadir

# 删除旧块,将磁盘空间要求降低到这个兆字节
prune

# 维护所有交易的索引
txindex

# 最大连接节点数
maxconnections

# 将交易内存池限制在几兆字节
maxmempool

# 每连接内存缓冲区限制
maxreceivebuffer/maxsendbuffer

# 最低交易费用,减少内存交易池的大小
minrelaytxfee

# 默认情况下,Bitcoin Core构建一个仅包含与用户钱包相关交易的数据库.如果想要使用诸如getrawtransaction之类的命令访问任何交易.则需要在配置文件中配置
txindex = 1

# 或者后期设置为完全索引
-reindex

# 完整索引的节点配置
alertnotify=myemailscript.sh "Alert: %s"
datadir=/lotsofspace/bitcoin
txindex=1
rpcuser=bitcoinrpc
rpcpassword=CHANGE_THIS

# 小型资源不足配置
alertnotify=myemailscript.sh "Alert: %s"
maxconnections=15
prune=5000
minrelaytxfee=0.0001
maxmempool=200
maxreceivebuffer=2500
maxsendbuffer=500
rpcuser=bitcoinrpc
rpcpassword=CHANGE_THIS


# 三种网络
-mainnet  主网     port:8333 rpcport:8332
-testnet  测试网络  port:18333 rpcport:18332
-regtest  本地测试  port:18444 rpcport:18443

# 单机运行多个比特币节点

# 默认配置文件路径
/home/yq/.bitcoin

# 节点0 (种子节点,配置是默认的)
# mkdir /home/yq/.bitcoin
# bitcoind -datadir=/home/yq/.bitcoin -port=8333 -rpcport=8332

# bitcoin-cli -rpcport=8332 getblockchaininfo

# 节点1 (调试/测试节点)
# mkdir /home/yq/.bitcoin1
# bitcoind -datadir=/home/yq/.bitcoin1 -port=28333 -rpcport=28332 -rpcuser=yq -rpcpassword=yq

# bitcoin-cli -rpcport=28332 -rpcuser=yq -rpcpassword=yq getblockchaininfo

```

常用命令
```bash
# 启动 regtest 监听: 18443 18444
bitcoind

# 运行在后端
bitcoind -daemon

# 获取信息
# bitcoin-cli getinfo
bitcoin-cli getblockchaininfo
bitcoin-cli getnetworkinfo
bitcoin-cli getwalletinfo

# 出块
bitcoin-cli generate 1

# 获取余额
bitcoin-cli getbalance

# 生成新的钱包地址
bitcoin-cli getnewaddress

# 转账
NEW_ADDRESS=2N48L2vFHGkweJKYK5SrhQ5zGmusPMycsFL
bitcoin-cli sendtoaddress $NEW_ADDRESS 10.00

# 显示和钱包地址有关的utxo  (加0 显示没有确认的)
bitcoin-cli listunspent 0

# 打包这笔交易
bitcoin-cli generate 1

# 获取交易
bitcoin-cli getrawtransaction $HASH
 
# 解码
bitcoin-cli decoderawtransaction $DATA
 
# 获取指定高度的区块的hash值
bitcoin-cli getblockhash 0

# 获取区块的信息
bitcoin-cli getblock $HASH
 
# 增加peer
bitcoin-cli addnode "192.168.2.244:8333" "onetry"
bitcoin-cli addnode "192.168.2.106:8333" "onetry"

# 启动时指定种子节点
bitcoind -seednode=192.168.2.244:8333
bitcoind -seednode=192.168.2.106:8333

```

```bash

alias bitcoind="bitcoind -rpcuser=ubuntu -rpcpassword=ubuntu -txindex -deprecatedrpc=signrawtransaction"

alias bitcoin-cli="bitcoin-cli -rpcuser=ubuntu -rpcpassword=ubuntu"

# 出块
bg() {bitcoin-cli generate $1}

# 区块链信息
bchain() {bitcoin-cli getblockchaininfo}

# 网络信息
bnetwork() {bitcoin-cli getnetworkinfo}

# 钱包信息
bwallet() {bitcoin-cli getwalletinfo}

# 高度 -> 区块信息
bblock() {HASH=`bitcoin-cli getblockhash $1` && bitcoin-cli getblock $HASH}

# txraw -> decode 
_btxdecode () {bitcoin-cli decoderawtransaction $1} 

# 交易hash -> txraw -> decode
_btxhashdecode() {_btxdecode `bitcoin-cli getrawtransaction $1`}

# 高度 -> coinbase hash
_bbasehash() {bblock $1 | python -c 'import json,sys;obj=json.load(sys.stdin);print (obj["tx"][0])'}

# 高度 -> coinbase hash -> txraw -> decode
bbasetx() {_btxhashdecode `_bbasehash $1`}

# 高度 -> coinbase hash -> tx
bbasetxx() {bitcoin-cli gettransaction `_bbasehash $1`}

# 高度, txidx -> tx hash
_bhtxhash() {bblock $1 | python -c 'import json,sys;obj=json.load(sys.stdin);print (obj["tx"]['$2'])'; }

# 高度, txidx -> tx hash -> txraw -> decode
bhtx() {_btxhashdecode `_bhtxhash $1 $2`}

# 获取余额
bbalance() {bitcoin-cli getbalance}

# 获取地址 (P2PKH)
bnewaddr() {bitcoin-cli getnewaddress "" legacy}

# 获取地址 (P2SH)
bnewaddrp2SH() {bitcoin-cli getnewaddress}

# 发送余额  
bsendaddress() {bitcoin-cli sendtoaddress $1 $2}

# 获得utxo
blistunspent() {bitcoin-cli listunspent $1}

# 创建裸交易
bcrerawtx() {bitcoin-cli createrawtransaction $1 $2} 

# 签名交易
bsignrawtx() {bitcoin-cli signrawtransaction $1 $2 $3}

# 发送裸交易
bsendrawtx() {bitcoin-cli sendrawtransaction $1}

# 获取私钥
bdumpprikey() {bitcoin-cli dumpprivkey $1}

# 获得裸交易池
brawmem() {bitcoin-cli getrawmempool}

# 获得地址的详细信息
baddressinfo() {bitcoin-cli getaddressinfo $1}

# 创建多重签名
baddmulsig() {bitcoin-cli addmultisigaddress $1 $2}

# 解析赎回脚本
_bdecodescript() {bitcoin-cli decodescript $1}

# 列高度low & high -> blockhash
blistblock() {
    for i in `seq $1 $2`; do
        hash=`bblock $i | python -c 'import json,sys;obj=json.load(sys.stdin);print (obj["hash"])'`
        print $i $hash
    done
}
```
