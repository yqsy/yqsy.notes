---
title: 服务器参数优化
date: 2017-11-19 22:58:21
categories: [网络相关]
---

<!-- TOC -->

- [1. 所有的内核参数](#1-所有的内核参数)
- [2. 最大描述符](#2-最大描述符)
- [3. /proc/sys/fs](#3-procsysfs)
- [4. /proc/sys/net](#4-procsysnet)

<!-- /TOC -->

<a id="markdown-1-所有的内核参数" name="1-所有的内核参数"></a>
# 1. 所有的内核参数

```bash
# 查看所有内核参数
sysctl -a

# 目录
/proc/sys
```

临时修改方法:
* 直接修改内核文件
* sysctl

永久修改方法:
* 修改/etc/sysctl.conf 并执行sysctl -p使之生效

<a id="markdown-2-最大描述符" name="2-最大描述符"></a>
# 2. 最大描述符

* https://docs.oracle.com/cd/E23389_01/doc.11116/e21036/perf002.htm

```bash
# 查看用户级文件描述符数限制
ulimit -n

cat /proc/sys/fs/file-max

# 已分配 未分配 最大分配
cat /proc/sys/fs/file-nr

# 临时将用户级文件描述符数限制为max-file-number
ulimit -SHn max-file-number

# 查看说明
man 5 limits.conf

# 永久修改用户级文件描述符数限制
vim /etc/security/limits.conf

*hard nofile max-file-number
*soft nofile max-file-number
```

<a id="markdown-3-procsysfs" name="3-procsysfs"></a>
# 3. /proc/sys/fs
与文件系统相关

* /proc/sys/fs/file-max: 系统级文件描述符数限制(临时修改)
* /proc/sys/fs/epoll/max_user_watches: 一个用户能够往epoll内核事件表中注册的事件的总量.它是指该用户打开的所有epoll实例总共能监听的事件数目,而不是单个epoll实例能监听的事件数目.往epoll内核事件表中注册一个事件,在32位系统上大概消耗90字节的内核控件,在64位系统上则消耗160字节的内核空间.所以这个内核参数限制了epoll使用的内核内存总量.

<a id="markdown-4-procsysnet" name="4-procsysnet"></a>
# 4. /proc/sys/net
网络模块相关

* /proc/sys/net/core/somaxconn: 指定listen监听队列里,能够建立完整连接从而进入ESTABLISHED或者SYN_RCVD状态的socket的最大数目
* /proc/sys/net/ipv4/tcp_max_syn_backlog: 指定listen监听队列里,能够转移至ESTAB-LISHED或者STB_RCVD状态的socket的最大数目
* /proc/sys/net/ipv4/tcp_wmem: TCP写缓冲区的最小值,默认值和最大值
* /proc/sys/net/ipv4/tcp_rmem: TCP读缓冲区的最小值,默认值和最大值
* /proc/sys/net/ipv4/tcp_syncookies: 指定是否打开TCP同步标签(syncookie).同步标签通过启动cookie来防止一个监听socket因不停地重复接收来自同一个地址的连接请求(同步报文段),而导致listen监听队列溢出(所谓SYN风暴)
