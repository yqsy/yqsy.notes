---
title: 底层细节
date: 2017-11-07 15:59:39
categories: [网络相关]
---

<!-- TOC -->

- [1. IP服务的特点](#1-ip服务的特点)

<!-- /TOC -->

<a id="markdown-1-ip服务的特点" name="1-ip服务的特点"></a>
# 1. IP服务的特点

IP为上层提供`无状态(stateless)`,`无连接(connectionless)`,`不可靠()`的服务

* https://en.wikipedia.org/wiki/IPv4#Header

![](http://ouxarji35.bkt.clouddn.com/snipaste_20171107_160542.png)

* 4位版本号(version),对于IPv4来说,其值是4
* 4位头部长度(header length),标识该IP头部有多少个32bit字,因为4位最大能表示15,所以IP头部最长是60字节
* 8位服务类型(Type Of Service, TOS),3:优先权(忽略),4:TOS字段,1:保留(置0),4位TOS字段表示:`最小延时`,`最大吞吐量`,`最高可靠性`,`最小费用`.最多只能有一个置1,比如ssh和telnet需要最小延时,文件传输程序ftp需要最大吞吐量
* 16位总长度(total length)指`整个IP数据报的长度`.最大长度为`65535`字节.但是由于MTU的限制,长度超过MTU的数据都将被`分片传输`,所以`实际传输的IP数据报的长度远远没有达到最大值`
* 16位标识(identification)唯一的标识主机发送的每一个数据包,每发送一个数据报,其值就加1
* 3位标志,第一位保留,第二位(Don't Fragment, `DF`)表示`禁止分片`,在这种情况下,如果IP数据报长度超过MTU的话,IP模块将丢弃该数据包并返回一个ICMP差错报文,第三位(More Fragment, `MF`)表示`更多分片`,除了数据报最后一个分片外,其他分片都要把它置1
